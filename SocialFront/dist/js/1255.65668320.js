"use strict";(self["webpackChunksocial_vue_3"]=self["webpackChunksocial_vue_3"]||[]).push([[1255],{2305:function(e,a,t){t.r(a),t.d(a,{default:function(){return U}});var s=t(641),l=t(33),n=t(953);const o={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",style:{background:"rgba(0, 0, 0, 0.5)"}},i={class:"modal-dialog modal-dialog-centered",role:"document"},c={class:"modal-content"},r={class:"modal-header"},d={class:"modal-body"};var u={__name:"SocialPostChinInfo",props:["chainInfo"],setup(e){const a=(0,n.KR)(!0);return(t,n)=>a.value?((0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",i,[(0,s.Lk)("div",c,[(0,s.Lk)("div",r,[n[2]||(n[2]=(0,s.Lk)("h5",{class:"modal-title"},"鏈上資訊",-1)),(0,s.Lk)("button",{type:"button",class:"close","aria-label":"Close",onClick:n[0]||(n[0]=e=>t.$emit("close"))},n[1]||(n[1]=[(0,s.Lk)("span",{"aria-hidden":"true"},"×",-1)]))]),(0,s.Lk)("div",d,[(0,s.Lk)("p",null,[n[3]||(n[3]=(0,s.Lk)("strong",null,"交易序號：",-1)),(0,s.eW)(" "+(0,l.v_)(e.chainInfo.transactionHash),1)]),(0,s.Lk)("p",null,[n[4]||(n[4]=(0,s.Lk)("strong",null,"發文者地址：",-1)),(0,s.eW)(" "+(0,l.v_)(e.chainInfo.authorAddress),1)]),(0,s.Lk)("p",null,[n[5]||(n[5]=(0,s.Lk)("strong",null,"智慧合約位址：",-1)),(0,s.eW)(" "+(0,l.v_)(e.chainInfo.smartContractAddress),1)]),(0,s.Lk)("p",null,[n[6]||(n[6]=(0,s.Lk)("strong",null,"文章標題：",-1)),(0,s.eW)(" "+(0,l.v_)(e.chainInfo.title),1)]),(0,s.Lk)("p",null,[n[7]||(n[7]=(0,s.Lk)("strong",null,"交易時間：",-1)),(0,s.eW)(" "+(0,l.v_)(e.chainInfo.timestamp),1)])])])])])):(0,s.Q3)("",!0)}},m=t(6262);const v=(0,m.A)(u,[["__scopeId","data-v-6e208906"]]);var k=v,h=t(4754),p=t(6278),g=t(5208),f=t(8071),y=t(8603),L=t(98),b=t(3761);const C={class:"card card-block card-stretch card-height"},w={class:"card-body"},_={class:"user-post-data"},I={class:"m-2"},A={class:"d-flex justify-content-between"},x=["src"],K={class:"w-100"},E={class:"d-flex justify-content-between align-items-center"},X={class:"col-7"},R={class:"d-flex align-items-center"},W={class:"mb-0 d-inline-block me-2"},H={class:"mb-0 text-primary"},Q=["onClick"],F={class:"d-flex justify-content-end align-items-center"},N={key:0,class:"me-2"},T=["onClick"],V={key:1,class:"me-2"},j=["onClick"],D={class:"me-2"},z=["onClick"],q={class:"mt-3"},M={class:"user-post"},P=["src"],B={class:"blog-meta d-flex align-items-center mt-3 mb-3 flex-wrap"},O={class:"me-4 d-flex align-items-center"},S={class:"me-4 d-flex align-items-center"},Y=["onClick"],$={key:1,class:"loading-spinner"};var G={__name:"MyArticles",props:{boardId:Number},setup(e){const{web3:a,socialContract:t,getAccount:o,contractAddress:i}=(0,L.A)(),c=(0,p.Pj)(),r=(0,n.KR)(!1),d=e=>{console.log("handleAIVerify"),ae.value=e,r.value=!0},u=()=>{r.value=!1},m=e=>{switch(e){case 1:return"col-10";case 2:return"col-6";case 3:return"col-4";case 4:return"col-6 col-md-3";default:return"col-6 col-md-4"}},v=(0,n.Kh)({show:!1,message:"",type:"info"});let G=null;const J=async e=>{if(!c.state.userInfo)return v.show=!0,v.message="請先登入!",void(v.type="warning");let a=await o();if(a!=c.state.userInfo?.address)return v.show=!0,v.message="請切換metamask帳戶為您註冊時帳號!",void(v.type="error");G={id:"",articleId:e.id,authorAddress:a,title:e.title,address:c.state.userInfo?.address,timestamp:Date.now(),transactionHash:""};const t=await Z(G.title,e.content,G.timestamp),s=await U();if(G.id=Number(s),console.log("data",G),!t)return v.show=!0,v.message="上鏈失敗請重試!",void v.type.error;const l=await(0,h.gO)(G);1===l.data.code?(e.chained=!0,v.message="上鏈成功!",v.type="success",v.show=!0):(v.message="區塊鏈記錄失敗",v.type="error",v.show=!0)},U=async()=>{try{const e=await t.methods.articleCount().call();return e}catch(e){return console.error("獲取文章數量時出錯:",e),null}},Z=async(e,a,s)=>{const l=await o(),n={from:l,to:i,value:"0",data:t.methods.publish(e,a,s).encodeABI()};try{const e=await window.ethereum.request({method:"eth_sendTransaction",params:[n]});return G.transactionHash=e,console.log("交易已提交，交易哈希:",e),!0}catch(c){return console.error("發送交易或監聽事件時出錯:",c),!1}},ee=(0,n.KR)(!1),ae=(0,n.KR)(null),te=(0,n.KR)(null),se=(0,n.KR)(null),le=e=>{ne.value=!ne.value,se.value=e},ne=(0,n.KR)(!1),oe=(0,n.KR)(!1),ie=(0,n.Kh)({transactionHash:"...",authorAddress:"...",smartContractAddress:"...",title:"...",timestamp:"..."}),ce=e=>{(0,h.wk)(e).then((e=>{if(1===e.data.code){console.log("res.data",e.data.data);const a=e.data.data;ie.transactionHash=a.transactionHash,ie.smartContractAddress="0x10997776a981A312998bE6b9cD7d5af8573943Cd",ie.title=a.title,ie.timestamp=a.timestamp,ie.authorAddress=a.authorAddress,oe.value=!0}else console.log("error:",e.data.msg)}))},re=e=>{const a=(0,g.zM)("boards"),t=a.find((a=>a.name===e));t.id?ve(t.id):console.error("未找到對應的看板 ID")},de=(0,n.KR)([]),ue=(0,n.KR)(1),me=(0,n.KR)(!1),ve=async(e=1)=>{if(!me.value){me.value=!0;try{const a=await(0,h.hg)(c.state.userInfo?.id,e);if(1===a.data.code){const e=a.data.data.filter((e=>!de.value.some((a=>a.id===e.id))));de.value=[...de.value,...e]}else console.log("error")}catch(a){console.error("請求出錯:",a)}finally{me.value=!1}}},ke=()=>{if(me.value)return;const e=document.documentElement.scrollHeight,a=document.documentElement.scrollTop,t=document.documentElement.clientHeight;a+t>=e-5&&(console.log("請求下一頁的文章",ue.value),ve(ue.value).then((()=>{ue.value++})))};return window.addEventListener("scroll",ke),(0,s.sV)((()=>{ue.value=1,ve(ue.value)})),(0,s.nT)((()=>{})),(0,s.sV)((()=>{ve(null)})),(e,a)=>{const t=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)(s.FK,null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(de.value,((e,o)=>((0,s.uX)(),(0,s.CE)("div",{class:"col-sm-12",key:o},[(0,s.Lk)("div",C,[(0,s.Lk)("div",w,[(0,s.Lk)("div",_,[(0,s.Lk)("h3",I,(0,l.v_)(e.title),1),(0,s.Lk)("div",A,[(0,s.bF)(t,{to:{name:"social.profile2",params:{userId:e.authorId}}},{default:(0,s.k6)((()=>[(0,s.Lk)("img",{class:"rounded-circle img-fluid fixed-size-img me-5",src:"data:image/png;base64,"+e.avatar,alt:""},null,8,x)])),_:2},1032,["to"]),(0,s.Lk)("div",K,[(0,s.Lk)("div",E,[(0,s.Lk)("div",X,[(0,s.Lk)("div",R,[(0,s.bF)(t,{to:{name:"social.profile2",params:{userId:e.authorId}}},{default:(0,s.k6)((()=>[(0,s.Lk)("h4",W,(0,l.v_)(e.authorName),1)])),_:2},1032,["to"]),(0,s.Lk)("span",H,(0,l.v_)((0,n.R1)(g.Yq)(e.publicationDate)),1)]),(0,s.Lk)("p",{class:"mb-0 text-muted",onClick:a=>re(e.boardName)},(0,l.v_)(e.boardName),9,Q)]),(0,s.Lk)("div",F,[e.chained?((0,s.uX)(),(0,s.CE)("div",N,[(0,s.Lk)("span",{class:"material-symbols-outlined chain-info-highlight",role:"button",title:"鏈上資訊",onClick:a=>ce(e.id),style:{"font-size":"32px","line-height":"1.5","vertical-align":"middle"}}," dataset_linked ",8,T),oe.value?((0,s.uX)(),(0,s.Wv)(k,{key:0,chainInfo:ie,onClose:a[0]||(a[0]=()=>oe.value=!1)},null,8,["chainInfo"])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),e.chained?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",V,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline-primary",onClick:a=>J(e)},"上鏈",8,j)])),(0,s.Lk)("div",D,[(0,s.Lk)("button",{onClick:a=>d(e.id),class:"btn btn-primary",style:{"white-space":"nowrap"}},"AI分析",8,z),e.id===ae.value&&r.value?((0,s.uX)(),(0,s.Wv)(y.A,{key:0,title:e.title,content:e.content,onClose:u},null,8,["title","content"])):(0,s.Q3)("",!0)])])])])])]),(0,s.Lk)("div",q,[(0,s.Lk)("p",null,(0,l.v_)(e.content),1)]),(0,s.Lk)("div",M,[(0,s.Lk)("div",{class:(0,l.C4)({row:e.images.length>1})},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.images,((a,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,l.C4)(m(e.images.length))},[(0,s.Lk)("img",{src:"data:image/png;base64,"+a,alt:"post-image",class:"img-fluid rounded"},null,8,P)],2)))),128))],2)]),(0,s.Lk)("div",B,[(0,s.Lk)("div",O,[(0,s.Lk)("i",{class:(0,l.C4)(["material-symbols-outlined pe-2 md-18 text-primary",{"custom-color":e.liked}])}," arrow_circle_up ",2),(0,s.eW)((0,l.v_)(e.likeCount)+" 支持者 ",1)]),(0,s.Lk)("div",S,[(0,s.Lk)("i",{class:(0,l.C4)(["material-symbols-outlined pe-2 md-18 text-primary",{"custom-color":e.disliked}])}," arrow_circle_down ",2),(0,s.eW)((0,l.v_)(e.dislikeCount)+" 不支持者 ",1)]),(0,s.Lk)("div",{onClick:a=>le(e.id),class:"comments me-4 d-flex align-items-center"},[a[3]||(a[3]=(0,s.Lk)("i",{class:"material-symbols-outlined pe-2 md-18 text-primary"}," mode_comment ",-1)),(0,s.eW)(" "+(0,l.v_)(e.commentCount)+" 評論數 ",1)],8,Y)])])])])))),128)),ee.value?((0,s.uX)(),(0,s.Wv)(f.A,{key:0,onClose:a[1]||(a[1]=e=>ee.value=!1),onVerify:e.verify,articleId:ae.value,articleTitle:te.value},null,8,["onVerify","articleId","articleTitle"])):(0,s.Q3)("",!0),me.value?((0,s.uX)(),(0,s.CE)("div",$," 加載中... ")):(0,s.Q3)("",!0),v.show?((0,s.uX)(),(0,s.Wv)(b.A,{key:2,message:v.message,type:v.type,onClose:a[2]||(a[2]=e=>v.show=!1)},null,8,["message","type"])):(0,s.Q3)("",!0)],64)}}};const J=(0,m.A)(G,[["__scopeId","data-v-c429e32a"]]);var U=J}}]);
//# sourceMappingURL=1255.65668320.js.map