"use strict";(self["webpackChunksocial_vue_3"]=self["webpackChunksocial_vue_3"]||[]).push([[5465],{7409:function(e,t,a){a.d(t,{OT:function(){return i},PG:function(){return n},bZ:function(){return o},jI:function(){return s}});var l=a(6593);function s(e,t,a=1){let s=`/article/list?page=${a}`;return t&&(s+=`&boardId=${t}`),e&&(s+=`&userId=${e}`),(0,l.E)({url:s,method:"get"})}function o(){return(0,l.E)({url:"/board/list",method:"get"})}function n(e){return(0,l.E)({url:`/article/search=${e}`,method:"get"})}function i(e){return(0,l.E)({url:`/notification/userid=${e}`,method:"get"})}},4973:function(e,t,a){a.d(t,{A:function(){return g}});var l=a(641),s=a(33),o=a(953);const n={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",style:{background:"rgba(0, 0, 0, 0.5)"}},i={class:"modal-dialog modal-dialog-centered",role:"document"},c={class:"modal-content"},r={class:"modal-header"},d={class:"modal-body"},u={key:0};var m={__name:"ChainInfo",props:{chainInfo:Object,mode:{type:Number,default:1}},setup(e){const t=(0,o.KR)(!0);return(a,o)=>t.value?((0,l.uX)(),(0,l.CE)("div",n,[(0,l.Lk)("div",i,[(0,l.Lk)("div",c,[(0,l.Lk)("div",r,[o[2]||(o[2]=(0,l.Lk)("h5",{class:"modal-title"},"鏈上資訊",-1)),(0,l.Lk)("button",{type:"button",class:"close","aria-label":"Close",onClick:o[0]||(o[0]=e=>a.$emit("close"))},o[1]||(o[1]=[(0,l.Lk)("span",{"aria-hidden":"true"},"×",-1)]))]),(0,l.Lk)("div",d,[(0,l.Lk)("p",null,[o[3]||(o[3]=(0,l.Lk)("strong",null,"交易序號：",-1)),(0,l.eW)(" "+(0,s.v_)(e.chainInfo.transactionHash),1)]),(0,l.Lk)("p",null,[o[4]||(o[4]=(0,l.Lk)("strong",null,"發文者地址：",-1)),(0,l.eW)(" "+(0,s.v_)(e.chainInfo.authorAddress),1)]),(0,l.Lk)("p",null,[o[5]||(o[5]=(0,l.Lk)("strong",null,"智慧合約位址：",-1)),(0,l.eW)(" "+(0,s.v_)(e.chainInfo.smartContractAddress),1)]),2!==e.mode?((0,l.uX)(),(0,l.CE)("p",u,[(0,l.Lk)("strong",null,(0,s.v_)(1===e.mode?"文章標題：":"驗證理由："),1),(0,l.eW)(" "+(0,s.v_)(e.chainInfo.title),1)])):(0,l.Q3)("",!0),(0,l.Lk)("p",null,[o[6]||(o[6]=(0,l.Lk)("strong",null,"交易時間：",-1)),(0,l.eW)(" "+(0,s.v_)(e.chainInfo.timestamp),1)])])])])])):(0,l.Q3)("",!0)}},k=a(6262);const v=(0,k.A)(m,[["__scopeId","data-v-6dced89e"]]);var g=v},5465:function(e,t,a){a.d(t,{A:function(){return M}});var l=a(641),s=a(33),o=a(953),n=a(3751),i=a(2281),c=a(4973),r=a(5909),d=a(7409),u=a(4754),m=a(6278),k=a(5208),v=a(8071),g=a(8603),f=a(3761),p=a(98);const h={class:"card card-block card-stretch card-height"},C={class:"card-body"},b={class:"user-post-data"},y={class:"m-2"},L={class:"d-flex justify-content-between"},A=["src"],I={class:"w-100"},w={class:"d-flex justify-content-between align-items-center"},_={class:"col-7"},x={class:"d-flex align-items-center"},E={class:"mb-0 d-inline-block me-2"},R={class:"mb-0 text-primary"},K=["onClick"],X={class:"d-flex justify-content-end align-items-center"},F={key:0,class:"me-2"},Q=["onClick"],W=["onClick"],j={class:"me-2"},S=["onClick"],z={class:"mt-3"},B={class:"user-post"},N=["src"],Y={class:"blog-meta d-flex align-items-center mt-3 mb-3 flex-wrap"},D=["onClick"],V=["onClick"],H=["onClick"],J=["onClick"],T={key:1,class:"comment-text d-flex align-items-center mt-3",action:"javascript:void(0);"},U=["onClick"],G={key:2,class:"loading-spinner"};var P={__name:"SocialPost",props:{boardId:Number},setup(e){const{web3:t,socialContract:a,getAccount:P,contractAddress:q}=(0,p.A)(),O=(0,m.Pj)(),M=e,Z=(0,o.KR)(!1),$=e=>{console.log("handleAIVerify"),oe.value=e,Z.value=!0},ee=()=>{Z.value=!1},te=(e,t="info")=>{ae.show=!0,ae.message=e,ae.type=t},ae=(0,o.Kh)({show:!1,message:"",type:"info"}),le=e=>{switch(e){case 1:return"col-10";case 2:return"col-6";case 3:return"col-4";case 4:return"col-6 col-md-3";default:return"col-6 col-md-4"}},se=(0,o.KR)(!1),oe=(0,o.KR)(null),ne=(0,o.KR)(null),ie=(e,t)=>{oe.value=e,se.value=!0,ne.value=t},ce=(0,o.KR)(null),re=e=>{de.value=!de.value,ce.value=e},de=(0,o.KR)(!1),ue=(0,o.KR)(!1),me=(0,o.Kh)({transactionHash:"...",authorAddress:"...",smartContractAddress:"...",title:"...",timestamp:"..."}),ke=e=>{(0,u.wk)(e).then((e=>{if(1===e.data.code){console.log("res.data",e.data.data);const t=e.data.data;me.transactionHash=t.transactionHash,me.smartContractAddress="0x10997776a981A312998bE6b9cD7d5af8573943Cd",me.title=t.title,me.timestamp=t.timestamp,me.authorAddress=t.authorAddress,ue.value=!0}else console.log("error:",e.data.msg)}))},ve=e=>{const t=(0,k.zM)("boards"),a=t.find((t=>t.name===e));a.id?he(a.id):console.error("未找到對應的看板 ID")},ge=(0,o.KR)([]),fe=(0,o.KR)(1),pe=(0,o.KR)(!1),he=async(e,t=1)=>{if(!pe.value){pe.value=!0,console.log("loadArticles",e,t);try{let a=await(0,d.jI)(O.state.userInfo?.id,e,t);1===a.data.code?ge.value=[...ge.value,...a.data.data||[]]:console.error("請求出錯:",a.data.msg)}catch(a){console.error("請求出錯:",a)}finally{pe.value=!1}}},Ce=()=>{const e=document.documentElement.scrollHeight,t=document.documentElement.scrollTop,a=document.documentElement.clientHeight;t+a>=e-5&&(fe.value++,console.log("請求下一頁的文章",fe.value),he(M.boardId,fe.value))};(0,l.hi)((()=>{window.removeEventListener("scroll",Ce)})),(0,l.wB)((()=>M.boardId),(e=>{null!==e&&(fe.value=1,ge.value=[],he(e,fe.value))})),(0,l.sV)((()=>{console.log("store.state.posts",O.state.posts.length),O.state.posts.length>0?(ge.value=O.state.posts,pe.value=!1,localStorage.removeItem("searchData")):(he(M.boardId||null),window.addEventListener("scroll",Ce))}));const be=async e=>{if(!e.liked&&!e.disliked){const t=await ye(e.id);t&&(e.liked=!0)}},ye=async e=>{try{const t=await(0,u.Hj)(O.state.userInfo?.id,e);if(1===t.data.code){const t=ge.value.find((t=>t.id===e));return t.likeCount++,!0}}catch(t){console.error("添加愛心失敗:",t)}return!1},Le=async e=>{if(!e.disliked&&!e.liked){const t=await Ae(e.id);t&&(e.disliked=!0)}},Ae=async e=>{try{const t=await(0,u.VQ)(O.state.userInfo?.id,e);if(1===t.data.code){const t=ge.value.find((t=>t.id===e));return t.dislikeCount++,!0}}catch(t){console.error("不支持失敗:",t)}return!1},Ie=async e=>{console.log("toggleBookmark",e.bookmarked),e.bookmarked?await _e(e.id):await we(e.id),e.bookmarked=!e.bookmarked},we=async e=>{try{const t=await(0,u.gb)(O.state.userInfo?.id,e);if(1===t.data.code){const t=ge.value.find((t=>t.id===e));t.bookmarkCount++,te("收藏成功","success")}}catch(t){console.error("添加收藏失敗:",t)}},_e=async e=>{try{const t=await(0,u.D_)(O.state.$userInfo?.id,e);if(1===t.data.code){const t=ge.value.find((t=>t.id===e));t.bookmarkCount--,te("取消藏成功","success")}}catch(t){console.error("取消收藏失敗:",t)}},xe=(0,o.KR)(""),Ee=async e=>{if(xe.value.trim())try{const t={articleId:e.id,userId:O.state.userInfo.id,content:xe.value},a=await(0,u.ZT)(t);1===a.data.code?(e.commentCount++,xe.value=""):console.error("發表評論失敗:",a.data.message)}catch(t){console.error("發表評論時發生錯誤:",t)}};return(e,t)=>{const a=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)(l.FK,null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ge.value,((e,d)=>((0,l.uX)(),(0,l.CE)("div",{class:(0,s.C4)(["col-sm-12",{"chained-article":e.chained}]),key:d},[(0,l.Lk)("div",h,[(0,l.Lk)("div",C,[(0,l.Lk)("div",b,[(0,l.Lk)("h3",y,(0,s.v_)(e.title),1),(0,l.Lk)("div",L,[(0,l.bF)(a,{to:{name:"social.profile2",params:{userId:e.authorId}}},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{class:"rounded-circle img-fluid fixed-size-img me-5",src:"data:image/png;base64,"+e.avatar,alt:""},null,8,A)])),_:2},1032,["to"]),(0,l.Lk)("div",I,[(0,l.Lk)("div",w,[(0,l.Lk)("div",_,[(0,l.Lk)("div",x,[(0,l.bF)(a,{to:{name:"social.profile2",params:{userId:e.authorId}}},{default:(0,l.k6)((()=>[(0,l.Lk)("h4",E,(0,s.v_)(e.authorName),1)])),_:2},1032,["to"]),(0,l.Lk)("span",R,(0,s.v_)((0,o.R1)(k.Yq)(e.publicationDate)),1)]),(0,l.Lk)("p",{class:"mb-0 text-muted",onClick:t=>ve(e.boardName)},(0,s.v_)(e.boardName),9,K)]),(0,l.Lk)("div",X,[e.chained?((0,l.uX)(),(0,l.CE)("div",F,[(0,l.Lk)("span",{class:"material-symbols-outlined chain-info-highlight",role:"button",title:"鏈上資訊",onClick:t=>ke(e.id),style:{"font-size":"32px","line-height":"1.5","vertical-align":"middle"}}," dataset_linked ",8,Q),ue.value?((0,l.uX)(),(0,l.Wv)(c.A,{key:0,chainInfo:me,onClose:t[0]||(t[0]=()=>ue.value=!1)},null,8,["chainInfo"])):(0,l.Q3)("",!0),(0,l.Lk)("button",{type:"button",class:"btn btn-outline-primary ms-1",onClick:t=>ie(e.id,e.title)},"發起驗證",8,W)])):(0,l.Q3)("",!0),(0,l.Lk)("div",j,[(0,l.Lk)("button",{onClick:t=>$(e.id),class:"btn btn-primary",style:{"white-space":"nowrap"}},"AI分析",8,S),e.id===oe.value&&Z.value?((0,l.uX)(),(0,l.Wv)(g.A,{key:0,id:e.id,title:e.title,content:e.content,onClose:ee},null,8,["id","title","content"])):(0,l.Q3)("",!0)])])])])])]),(0,l.Lk)("div",z,[(0,l.Lk)("p",null,(0,s.v_)(e.content),1)]),(0,l.Lk)("div",B,[(0,l.Lk)("div",{class:(0,s.C4)({row:e.images.length>1})},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.images,((t,a)=>((0,l.uX)(),(0,l.CE)("div",{key:a,class:(0,s.C4)(le(e.images.length))},[(0,l.Lk)("img",{src:"data:image/png;base64,"+t,alt:"post-image",class:"img-fluid rounded"},null,8,N)],2)))),128))],2)]),(0,l.Lk)("div",Y,[(0,l.Lk)("div",{class:"me-4 d-flex align-items-center",onClick:t=>be(e)},[(0,l.Lk)("i",{class:(0,s.C4)(["material-symbols-outlined pe-2 md-18 text-primary",{"custom-color":e.liked}])}," arrow_circle_up ",2),(0,l.eW)((0,s.v_)(e.likeCount)+" 支持者 ",1)],8,D),(0,l.Lk)("div",{class:"me-4 d-flex align-items-center",onClick:t=>Le(e)},[(0,l.Lk)("i",{class:(0,s.C4)(["material-symbols-outlined pe-2 md-18 text-primary",{"custom-color":e.disliked}])}," arrow_circle_down ",2),(0,l.eW)((0,s.v_)(e.dislikeCount)+" 不支持者 ",1)],8,V),(0,l.Lk)("div",{onClick:t=>re(e.id),class:"comments me-4 d-flex align-items-center"},[t[4]||(t[4]=(0,l.Lk)("i",{class:"material-symbols-outlined pe-2 md-18 text-primary"}," mode_comment ",-1)),(0,l.eW)(" "+(0,s.v_)(e.commentCount)+" 評論數 ",1)],8,H),(0,l.Lk)("div",{class:"ms-auto d-flex align-items-center",onClick:t=>Ie(e)},[(0,l.Lk)("i",{class:(0,s.C4)(["material-symbols-outlined pe-2 md-18 text-primary",{"custom-color":e.bookmarked}]),style:{"font-size":"28px"}}," bookmark ",2)],8,J)]),de.value&&ce.value===e.id?((0,l.uX)(),(0,l.Wv)(r.A,{key:0,article_id:e.id},null,8,["article_id"])):(0,l.Q3)("",!0),ce.value===e.id?((0,l.uX)(),(0,l.CE)("form",T,[(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control rounded",placeholder:"輸入你的留言","onUpdate:modelValue":t[1]||(t[1]=e=>xe.value=e)},null,512),[[n.Jo,xe.value]]),(0,l.Lk)("div",{class:"comment-attagement d-flex",onClick:t=>Ee(e)},t[5]||(t[5]=[(0,l.Lk)("img",{src:i,alt:"userimg",class:"me-3 img-fluid"},null,-1)]),8,U)])):(0,l.Q3)("",!0)])])],2)))),128)),se.value?((0,l.uX)(),(0,l.Wv)(v.A,{key:0,onClose:t[2]||(t[2]=e=>se.value=!1),onVerify:e.verify,articleId:oe.value,articleTitle:ne.value},null,8,["onVerify","articleId","articleTitle"])):(0,l.Q3)("",!0),ae.show?((0,l.uX)(),(0,l.Wv)(f.A,{key:1,message:ae.message,type:ae.type,onClose:t[3]||(t[3]=e=>ae.show=!1)},null,8,["message","type"])):(0,l.Q3)("",!0),pe.value?((0,l.uX)(),(0,l.CE)("div",G," 加載中... ")):(0,l.Q3)("",!0)],64)}}},q=a(6262);const O=(0,q.A)(P,[["__scopeId","data-v-53b6e371"]]);var M=O},5909:function(e,t,a){a.d(t,{A:function(){return L}});var l=a(641),s=a(33),o=a(953),n=a(4754),i=a(5208),c=a(6278);const r={class:"comment-area mt-3"},d={class:"post-comments list-inline p-0 m-0"},u={class:"d-flex"},m={class:"user-img"},k=["src"],v={class:"comment-data-block ms-3"},g={class:"d-flex align-items-center"},f={class:"mb-0"},p={class:"ms-2 text-muted"},h={class:"mb-0"},C=["onClick"];var b={__name:"SocialPostComment",props:{article_id:String},setup(e){const t=(0,c.Pj)(),a=e,b=(0,o.KR)([]),y=async()=>{try{const e=await(0,n.UY)(a.article_id,t.state.userInfo?.id);1===e.data.code?(b.value=e.data.data,console.log("comments:",b.value)):console.error("取得評論列表失敗:",e.data.message)}catch(e){console.error("取得評論列表時發生錯誤:",e)}},L=async e=>{try{const a=t.state.userInfo?.id,l=await(0,n.Ry)(e,a);if(1===l.data.code){const t=b.value.find((t=>t.id===e));t&&(t.likeCount+=1,t.liked=!0)}else console.error("按讚失敗:",l.data.message)}catch(a){console.error("按讚時發生錯誤:",a)}};return(0,l.sV)(y),(e,t)=>((0,l.uX)(),(0,l.CE)("div",r,[t[0]||(t[0]=(0,l.Lk)("hr",null,null,-1)),(0,l.Lk)("ul",d,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(b.value,((e,t)=>((0,l.uX)(),(0,l.CE)("li",{key:t},[(0,l.Lk)("div",u,[(0,l.Lk)("div",m,[(0,l.Lk)("img",{src:"data:image/png;base64,"+e.avatar,alt:"userimg",class:"avatar-35 rounded-circle img-fluid"},null,8,k)]),(0,l.Lk)("div",v,[(0,l.Lk)("div",g,[(0,l.Lk)("h6",f,(0,s.v_)(e.authorName),1),(0,l.Lk)("span",p,(0,s.v_)((0,o.R1)(i.Yq)(e.commentDate)),1)]),(0,l.Lk)("p",h,(0,s.v_)(e.content),1),(0,l.Lk)("div",null,[(0,l.Lk)("button",{onClick:t=>L(e.id),class:"btn btn-link p-0"},[(0,l.Lk)("i",{class:(0,s.C4)(["material-symbols-outlined",{"text-primary":e.liked}])}," thumb_up ",2),(0,l.eW)(" "+(0,s.v_)(e.likeCount),1)],8,C)])])])])))),128))])]))}};const y=b;var L=y},2281:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAT1JREFUSEu1le9twjAQxd9ZlBHYAjIEFFRVGaCZgq+doF+ZIgyAqoo/GSJ4i4xAIYfcypBUl9jBaT477+e7e/dM+OePqvqbxTFRF+jXw0T3xa0D5vkGoIKI9RMjXeyiIhQkAKwkFSBk8XaShkBkANEazG+/wmEgERDvong7z0dnYFkC4xBQI8C25es5n56JEoBHFqRKrHyN4AQYUVPNiWgGxtSCiJD5GMELYKu5g+rzGTIfmhzXCeACSY57CFAFfRMS/mmd7LiWPai73ziraR8kxw3B76ZtvQFOoA/JacEtcu3KQ4AmN/UyZJO49xgxSULrtrzyruCvsAL0AFi5EtcJ+Jwdx6XCsveokKw3YE5f9lHWJb7FCkzOtC1PMOAm4BigD6jxwQl9yW7vYvUWJvsVQbuc4XNzEdDlR9+zVx4h7BlM3pq2AAAAAElFTkSuQmCC"}}]);
//# sourceMappingURL=5465.3b74873b.js.map